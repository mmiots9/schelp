<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dimensionality reduction • schelp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dimensionality reduction">
<!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-YDEBEF61BH"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YDEBEF61BH');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">schelp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">4.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/qc.html">Quality control</a></li>
    <li><a class="dropdown-item" href="../articles/dimred.html">Dimensionality reduction</a></li>
    <li><a class="dropdown-item" href="../articles/clustering.html">Clustering</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mmiots9/schelp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dimensionality reduction</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mmiots9/schelp/blob/master/vignettes/articles/dimred.Rmd" class="external-link"><code>vignettes/articles/dimred.Rmd</code></a></small>
      <div class="d-none name"><code>dimred.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mmiots9/schelp" class="external-link">schelp</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: Seurat</span></span>
<span><span class="co">#&gt; Loading required package: SeuratObject</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="co">#&gt; 'SeuratObject' was built under R 4.4.0 but the current version is</span></span>
<span><span class="co">#&gt; 4.4.1; it is recomended that you reinstall 'SeuratObject' as the ABI</span></span>
<span><span class="co">#&gt; for R may have changed</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'SeuratObject'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, t</span></span>
<span><span class="va">pbmc_small</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="section level2">
<h2 id="load-data">Load data<a class="anchor" aria-label="anchor" href="#load-data"></a>
</h2>
<p>We will use the <code>pbmc_small</code> dataset provided by
<code>SeuratObject</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pbmc_small"</span><span class="op">)</span></span>
<span><span class="va">pbmc_small</span></span>
<span><span class="co">#&gt; An object of class Seurat </span></span>
<span><span class="co">#&gt; 230 features across 80 samples within 1 assay </span></span>
<span><span class="co">#&gt; Active assay: RNA (230 features, 20 variable features)</span></span>
<span><span class="co">#&gt;  3 layers present: counts, data, scale.data</span></span>
<span><span class="co">#&gt;  2 dimensional reductions calculated: pca, tsne</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-top-variable-features">Plot top variable features<a class="anchor" aria-label="anchor" href="#plot-top-variable-features"></a>
</h2>
<p>One of the first step after QC is to find the variable features in
our dataset. Once done, we can visualize the top variable features using
<code><a href="../reference/plot_variable_features.html">plot_variable_features()</a></code>, which is a wrapper around
<code><a href="https://satijalab.org/seurat/reference/VariableFeaturePlot.html" class="external-link">Seurat::VariableFeaturePlot()</a></code> function. It plots the
variable features and labels the top_n ones:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_variable_features.html">plot_variable_features</a></span><span class="op">(</span><span class="va">pbmc_small</span>, top_n <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="dimred_files/figure-html/variable-features-1.png" alt="Variable feature plot" width="1400" style="display: block; margin: auto;"></p>
<blockquote>
<p><strong><em>Note</em></strong>: The <code>top_n</code> argument is
used to set the number of highly variable features to label, NOT how
many variable feature to calculate, as calculation should be done prior
to run this function (e.g. with
<code><a href="https://satijalab.org/seurat/reference/FindVariableFeatures.html" class="external-link">Seurat::FindVariableFeatures()</a></code>).</p>
</blockquote>
</div>
<div class="section level2">
<h2 id="calculate-optimal-dimensions">Calculate optimal dimensions<a class="anchor" aria-label="anchor" href="#calculate-optimal-dimensions"></a>
</h2>
<p>Usually, after PCA, another dimensionality reduction to perform is
UMAP or TSNE. To decide how many PCs to use one should look at the elbow
plot, or use a more <a href="https://hbctraining.github.io/scRNA-seq_online/lessons/elbow_plot_metric.html" class="external-link">quantitative
approach</a>.</p>
<p>Here, this approach is performed using <code><a href="../reference/calc_dims.html">calc_dims()</a></code>
function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbmc_small</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_dims.html">calc_dims</a></span><span class="op">(</span><span class="va">pbmc_small</span>, reduction <span class="op">=</span> <span class="st">"pca"</span><span class="op">)</span></span>
<span><span class="co">#&gt; The dimension that exhibits cumulative percent greater than 90% and % variation associated with the PC as less than 5 is 15 </span></span>
<span><span class="co">#&gt; The first dimension that exhibits a difference with the next &lt; 0.1 is 19 </span></span>
<span><span class="co">#&gt; This values are stored in seurat_object[[pca]]@misc.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-splitted-dimplot">Plot splitted dimplot<a class="anchor" aria-label="anchor" href="#plot-splitted-dimplot"></a>
</h2>
<p>Another helpful method I always use in my analysis to understand
whether some <code>meta.data</code> column is a unwanted source of
variability is <code><a href="../reference/plot_splitted_dimplots.html">plot_splitted_dimplots()</a></code>. Using any
reduction it shows how every level of the chosen meta.data column
distribute in the dimension plot:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_splitted_dimplots.html">plot_splitted_dimplots</a></span><span class="op">(</span><span class="va">pbmc_small</span>, group_by <span class="op">=</span> <span class="st">"groups"</span>, </span>
<span>                       heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="dimred_files/figure-html/plot-splitted-dimplots-1.png" alt="Splitted dimplot pca" width="1400" style="display: block; margin: auto;"></p>
<p>It can be applied to any reduction. I use it a lot to understand
whether integration worked well:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_splitted_dimplots.html">plot_splitted_dimplots</a></span><span class="op">(</span><span class="va">pbmc_small</span>, reduction <span class="op">=</span> <span class="st">"tsne"</span>,</span>
<span>                       group_by <span class="op">=</span> <span class="st">"groups"</span>, </span>
<span>                       heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="dimred_files/figure-html/plot-splitted-dimplots-tsne-1.png" alt="Splitted dimplot tsne" width="1400" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matteo Miotto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
